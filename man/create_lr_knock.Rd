% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/create_lr_knock.R
\name{create_lr_knock}
\alias{create_lr_knock}
\title{Knockoff construction using low rank structure}
\usage{
create_lr_knock(Xl, Bl, err)
}
\arguments{
\item{Xl}{A numeric matrix of dimension n x k containing latent factors.}

\item{Bl}{A numeric matrix of dimension k x p containing factor loadings.}

\item{err}{A numeric vector of length p containing estimated error variances.}
}
\value{
A numeric matrix of dimension \eqn{n \times p} containing one set of
low-rank knockoff variables. The knockoffs are constructed as
\deqn{X_l B_l + E,}
where \eqn{E} is a noise matrix with independent columns and variances
specified by \code{err}. The returned matrix is not rescaled; rescaling
should be performed separately (e.g., using \code{rescale_knockoff}).
}
\description{
Knockoff construction using low rank structure
}
\details{
Constructs low-rank knockoff variables based on the output of
\code{sc_softImpute}. By exploiting a low-rank structure in the data,
this approach can offer substantial computational advantages when
such a structure is appropriate. The knockoffs are generated using a
low-rank approximation of the original data matrix combined with an
additive noise term.
}
\examples{
set.seed(2024)
# Create dataset
X <- matrix(rnorm(1000),nrow = 100)
Bl <- matrix(rnorm(800),ncol=80)
err <- abs(rnorm(80,sd=3))

E <- matrix(NA,nrow = 100,ncol = 80)
for(i in 1:80){
  E[,i] = rnorm(100, sd = err[i])
}

np_data <- X\%*\%Bl + E

rownames(np_data) <- paste0("r", 1:100)
colnames(np_data) <- paste0("c", 1:80)

# Create missing data
miss <- sample(1:prod(dim(np_data)), floor(prod(dim(np_data))*0.6))
np_data[miss] <- 0

np_data_exp <- matrix(1, nrow=100, ncol=80)
np_data_exp[miss] <- 0

np_data_exp.count <- apply(np_data_exp,2,sum)

# Center target matrix, but only center the expressed parts.
np_data.avg <- (colSums(np_data, na.rm = TRUE))/(np_data_exp.count-1)
np_data_centered <- sweep(np_data,2,np_data.avg,FUN = "-")*(np_data_exp)

# Impute missing values
np_data_imp <- sc_softImpute(np_data_centered, np_data_exp, X[,1:3], PC = min(np_data_exp.count)-5)

# Low-rank Knockoff construction
lr_knk <- create_lr_knock(np_data_imp$Xl,
                         np_data_imp$Bl,
                         np_data_imp$err)

lr_knk <- rescale_knockoff(lr_knk,np_data_exp,np_data.avg)

}
\references{
Fan, Y., Lv, J., Sharifvaghefi, M., and Uematsu, Y. (2020).
\emph{IPAD: Stable Interpretable Forecasting with Knockoffs Inference}.
\emph{Journal of the American Statistical Association}, 115(532), 1822--1834.
}
\seealso{
Other create: 
\code{\link{create_decomp_knock}()},
\code{\link{create_multi_decomp_knock}()},
\code{\link{create_multi_lr_knock}()}
}
\concept{create}
