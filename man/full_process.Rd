% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/full_process.R
\name{full_process}
\alias{full_process}
\title{Variable selection using decomp knockoffs with a Seurat dataset}
\usage{
full_process(
  Seurat_data,
  latent.vars_imp = NULL,
  latent.vars_comp = NULL,
  PC,
  ident.1 = NULL,
  ident.2 = NULL,
  slot_name = "data",
  test.use,
  q = 0.1,
  m = 1,
  max_it = 100
)
}
\arguments{
\item{Seurat_data}{A Seurat object}

\item{latent.vars_imp}{A character vector specifying covariates to be included
when performing \code{sc_softImpute()}. These variables must be present in
the \code{Seurat} object.}

\item{latent.vars_comp}{A character vector specifying covariates to be included
when computing feature importance. These variables must be present in
the \code{Seurat} object.}

\item{PC}{A positive integer specifying the number of latent factors.}

\item{ident.1}{Same as \code{ident.1} in \code{Seurat::FindMarkers}. If
\code{NULL}, the first level of \code{Idents(np_data.sub)} is used.}

\item{ident.2}{Same as \code{ident.2} in \code{Seurat::FindMarkers}. If
\code{NULL}, \code{feature_importance()} uses the default behavior of
\code{Seurat::FindMarkers}.}

\item{slot_name}{A character string specifying which assay slot (or layer) to use.
This argument is passed to \code{Seurat::FindMarkers} as \code{slot}.}

\item{test.use}{A character string specifying the test used to compute
feature importance statistics. This argument corresponds to
\code{test.use} in \code{Seurat::FindMarkers}. In addition, the lasso
coefficient difference statistic is supported by setting
\code{test.use = "LCD"}.}

\item{q}{A numeric scalar in (0, 1) specifying the target FDR level.}

\item{m}{A positive integer specifying the number of knockoffs to be constructed;
default is 1.
If \code{m = 1}, a single knockoff is constructed using
\code{create_decomp_knock()}.
If \code{m >= 2}, multiple knockoffs are constructed using
\code{create_multi_decomp_knock()}.}

\item{max_it}{A positive integer specifying the maximum number of iterations;
default is 100.}
}
\value{
A list containing the indices of selected variables and the corresponding
variable names.
}
\description{
Variable selection using decomp knockoffs with a Seurat dataset
}
\details{
This function provides a minimal, end-to-end example of variable selection
using matrix decomposition-based knockoffs on a \code{Seurat} dataset.
The normalized expression matrix (specified by \code{slot_name}) is centered
gene-wise using means computed over observed entries (as indicated by the
count-based expression pattern). The centered matrix is then imputed via
\code{sc_softImpute()}, followed by knockoff construction and feature
importance calculation using \code{feature_importance()}.
Variables are selected by \code{knockfilter_select()} to control the FDR at
level \code{q}.
}
\examples{
# Read a dataset from the Seurat package
library(Seurat)
pbmc_raw <- read.table(
  file = system.file('extdata', 'pbmc_raw.txt', package = 'Seurat'),
  as.is = TRUE
)
pbmc_raw <- as(as.matrix(pbmc_raw), "dgCMatrix")
pbmc_small <- Seurat::CreateSeuratObject(counts = pbmc_raw)

pbmc_small.count <- Seurat::GetAssayData(object = pbmc_small, layer = "count")
pbmc_small.data <-
  Seurat::NormalizeData(object = pbmc_small.count,
                        normalization.method = "LogNormalize",
                        scale.factor = 10000, #' Default = 10000,
                        margin = 1,
                        verbose = FALSE)

pbmc_small = Seurat::SetAssayData(object = pbmc_small, layer = "data", new.data = pbmc_small.data)

pbmc_small.exp <- t(pbmc_small.count > 0)
CDR <- rowMeans(pbmc_small.exp)

pbmc_small$CDR = CDR

Seurat::Idents(pbmc_small) = as.factor(rep(c("A", "B"), each = length(CDR)/2))

set.seed(1010)
full_process(Seurat_data = pbmc_small,
             PC = 3,
             ident.1 = "A",
             ident.2 = "B",
             latent.vars_comp = "CDR",
             latent.vars_imp = "CDR",
             test.use = "LCD",
             m = 1)


}
